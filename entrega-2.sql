CREATE TABLE JUEGOS(
ID_JUEGO NUMBER PRIMARY KEY,
TITULO VARCHAR2(150) NOT NULL,
GENERO VARCHAR2(50),
FECHA_LANZAMIENTO DATE);

CREATE TABLE PLATAFORMAS(
ID_PLATAFORMA NUMBER PRIMARY KEY,
NOMBRE VARCHAR2(20) NOT NULL);

CREATE TABLE JUEGOS_PLATAFORMA(
ID_JUEGO NUMBER,
ID_PLATAFORMA NUMBER,
CONSTRAINT FK_JUEGO FOREIGN KEY (ID_JUEGO) REFERENCES JUEGOS(ID_JUEGO),
CONSTRAINT FK_PLATAFORMA FOREIGN KEY (ID_PLATAFORMA) REFERENCES PLATAFORMAS(ID_PLATAFORMA),
PRIMARY KEY(ID_JUEGO, ID_PLATAFORMA));

INSERT INTO JUEGOS(ID_JUEGO, TITULO, GENERO, FECHA_LANZAMIENTO)
VALUES (101, 'DELTARUNE', 'RPG', TO_DATE('2018-10-31', 'YYYY-MM-DD'));
INSERT INTO JUEGOS(ID_JUEGO, TITULO, GENERO, FECHA_LANZAMIENTO)
VALUES (102, 'SUPER MARIO ODYSSEY', 'PLATAFORMAS', TO_DATE('2017-10-27', 'YYYY-MM-DD'));
INSERT INTO JUEGOS(ID_JUEGO, TITULO, GENERO, FECHA_LANZAMIENTO)
VALUES (103, 'CALL OF DUTY: MODERN WARFARE III', 'SHOOTER', TO_DATE('2023-11-10', 'YYYY-MM-DD'));

INSERT INTO PLATAFORMAS(ID_PLATAFORMA, NOMBRE) VALUES (1, 'PC');
INSERT INTO PLATAFORMAS(ID_PLATAFORMA, NOMBRE) VALUES (2, 'PLAYSTATION');
INSERT INTO PLATAFORMAS(ID_PLATAFORMA, NOMBRE) VALUES (3, 'NINTENDO SWITCH');

INSERT INTO JUEGOS_PLATAFORMA(ID_JUEGO, ID_PLATAFORMA) VALUES (101,1);
INSERT INTO JUEGOS_PLATAFORMA(ID_JUEGO, ID_PLATAFORMA) VALUES (101,3);

INSERT INTO JUEGOS_PLATAFORMA(ID_JUEGO, ID_PLATAFORMA) VALUES (102,3);

INSERT INTO JUEGOS_PLATAFORMA(ID_JUEGO, ID_PLATAFORMA) VALUES (103,1);
INSERT INTO JUEGOS_PLATAFORMA(ID_JUEGO, ID_PLATAFORMA) VALUES (103,2);

COMMIT;

ALTER TABLE JUEGOS
ADD CONSTRAINT UQ_JUEGO_TITULO UNIQUE (TITULO);

CREATE TABLE DESARROLLADORES (
ID_DESARROLLADOR NUMBER PRIMARY KEY,
NOMBRE_DESARROLLADOR VARCHAR2(30) NOT NULL UNIQUE
);

CREATE TABLE GENEROS(
ID_GENERO NUMBER PRIMARY KEY,
NOMBRE_GENERO VARCHAR2(30) NOT NULL UNIQUE
);

ALTER TABLE JUEGOS
ADD ID_DESARROLLADOR NUMBER;

ALTER TABLE JUEGOS
ADD ID_GENERO NUMBER;

ALTER TABLE JUEGOS
ADD CONSTRAINT FK_JUEGO_DESARROLADOR
FOREIGN KEY(ID_DESARROLLADOR) REFERENCES DESARROLADORES (ID_DESARROLLADOR);

ALTER TABLE JUEGOS
ADD CONSTRAINT FK_JUEGO_GENERO
FOREIGN KEY (ID_GENERO) REFERENCES GENEROS(ID_GENERO);

INSERT INTO DESARROLLADORES(ID_DESARROLLADOR, NOMBRE_DESARROLLADOR) VALUES (1, 'TOBY FOX');
INSERT INTO DESARROLLADORES(ID_DESARROLLADOR, NOMBRE_DESARROLLADOR) VALUES (2, 'NINTENDO EPD');
INSERT INTO DESARROLLADORES(ID_DESARROLLADOR, NOMBRE_DESARROLLADOR) VALUES (3, 'INFINITY WARD');
INSERT INTO DESARROLLADORES(ID_DESARROLLADOR, NOMBRE_DESARROLLADOR) VALUES (4, 'VALVE');

INSERT INTO GENEROS(ID_GENERO, NOMBRE_GENERO) VALUES (10,'RPG');
INSERT INTO GENEROS(ID_GENERO, NOMBRE_GENERO) VALUES (20,'PLATAFORMAS');
INSERT INTO GENEROS(ID_GENERO, NOMBRE_GENERO) VALUES (30,'SHOOTER');
INSERT INTO GENEROS(ID_GENERO, NOMBRE_GENERO) VALUES (40,'MOBA');

UPDATE JUEGOS SET ID_DESARROLLADOR = 1, ID_GENERO = 10 WHERE ID_JUEGO = 101;

UPDATE JUEGOS SET ID_DESARROLLADOR = 2, ID_GENERO = 20 WHERE ID_JUEGO = 102;

UPDATE JUEGOS SET ID_DESARROLLADOR = 3, ID_GENERO = 30 WHERE ID_JUEGO = 103;

ALTER TABLE JUEGOS
DROP COLUMN GENERO;

COMMIT;

SELECT 
    G.NOMBRE_GENERO, 
    COUNT(J.ID_JUEGO) AS "TOTAL DE JUEGOS"
FROM 
    GENEROS G
JOIN 
    JUEGOS J ON G.ID_GENERO = J.ID_GENERO
GROUP BY 
    G.NOMBRE_GENERO;
    
SELECT TITULO, ID_JUEGO
FROM JUEGOS
WHERE ID_JUEGO IN (
    SELECT ID_JUEGO 
    FROM JUEGOS_PLATAFORMA 
    WHERE ID_PLATAFORMA = 1
);